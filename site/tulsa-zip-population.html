<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: 'Inter',sans-serif;
      color: #333333;
      margin: 0;
      padding: 20px;
    }

    h1 {
      font-family: 'Montserrat', serif;
      font-weight: 700;
      color: black;
    }

    p{
      max-width:600px;
    }

    .subtitle{
      font-style:italic;
      color:#666;
    }

    .borough-label{
      fill: #111;
    }

    .ls-background{
      fill:#DDD;
    }
  </style>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="../dist/index.js"></script>

    <!-- Google Fonts preconnect for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Import Inter, Playfair Display, and add Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
</head>
<body>
<h1>Tulsa population by borough</h1>
<p class="subtitle">GLA Population Estimate 2025 (thousands)</p>
<p>This example illustrates how you might use the After the Flood <a href="https://github.com/aftertheflood/londonsquared">London Squared</a> module for D3 to visualise a single variable accross all London boroughs.</p>
<div class="vizualisation-container"></div>
</body>
<script>
window.onload = ()=>{
  const width = 600;
  const height = 525;

  const plottedProperty = 'medianHomeValue'

  const svg = d3.select('.vizualisation-container')
    .append('svg')
    .attr('width', width)
    .attr('height', height);

  d3.csv('data/tulsa-zip-demographics-2025.csv')
    .then((data)=>{
      console.log(data);

      const LS = atf.londonSquared({gridGapProportion:0.05})
        .data(data, d=>d.Code) //the second argument is an accessor for the local authority code associated with the data row. by default this is d=>d.code
        .width(width)
        .height(height);

      console.log(LS)

      svg.call(LS); // draw the cartogram shapes
      
      const circleScale = d3.scalePow()
        .domain([0, d3.max(data, d => Number(d[plottedProperty]))])
        .range([0, LS.blockSize()/2])

      console.log(circleScale.domain(), circleScale.range());
      
      LS.masked()
        .call(function(parent){
          parent.append('circle')
            .attr('r', d => {
              console.log(d); 
              return circleScale(d.data[plottedProperty])
            })
            .attr('cx', LS.centroid()[0])
            .attr('cy', LS.centroid()[1])
            .attr('fill', '#f00');
        });
      
      LS.foreground()
        .call(function(parent){
          parent.append('text')
            .attr('class', 'borough-label')
            .attr('x', 5)
            .attr('y', 15)
            .text(d => d.LSAbbreviation);
          
          parent.append('text')
            .attr('class', 'borough-label')
            .attr('x', 5)
            .attr('y', LS.blockSize()-5)
            .text(d => `${d.data[plottedProperty]/1000}k`);
        })
    })
    .catch(err=>{
      console.log(err);
    })
}
</script>
</html>